/* mangle.c
 *
 * Copyright (c) 2013-2021 Andrew Starritt
 *
 * The mangle program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * The mangle program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with the mangle program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Author: Andrew Starritt
 * Contact details:  andrew.starritt@gmail.com
 *
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>

#define MANGLE_VERSION_STRING  "1.2.1"

#define MAX_NSETS  32

typedef unsigned char byte;

static const byte map_data [MAX_NSETS] [256] = {
   {
       22,  63, 255, 175, 206, 118, 123, 144, 192, 225, 218,  60, 117, 161,  83, 106,
      233,  59, 174,  40, 197, 183,  54, 148,  31, 141, 170, 139,  93,  61, 112,  50,
      165, 196,  37,  81, 176, 217, 124, 137,  12,  80,   2, 246,  92,  23,  55,  89,
      110, 232, 245,  86, 155, 182,  53, 166,  62, 127,  48,  45, 219,  90,  15, 113,
       91, 191,  67, 224, 147,  46,  84,  72,  76, 145,  75, 227, 241, 129, 149,  69,
      132, 115,  44,   6, 126,  98, 156,  88,  96,  35,  77,  49, 222, 228,  99, 204,
      130,  32, 138, 220, 201, 231, 238,   9,  57, 243, 131, 251, 160, 215, 210, 135,
       39,  94, 178, 203, 244,  24,  97,  56,  68, 136, 202, 184, 150, 152, 242, 186,
       30,  11,  41,  17,  21, 207, 107, 158,  95, 211, 199, 250, 108, 229, 195, 189,
      119, 171, 151, 140, 188, 172, 134, 181, 121, 180,  27, 237, 105, 193, 104, 198,
      185, 162,  71, 179, 253,  26,   8, 142, 122, 125, 213, 120, 214, 128,  52,  85,
       13, 216, 100,  10, 209,  19, 208, 143, 163, 248, 169, 254,  33, 190, 226, 236,
      116,  42, 234,  16, 247,  74, 164, 103,  25, 157,   3, 173, 194,  20, 159, 221,
       82, 111, 153,  73,  64, 168,  18, 101,   1,  14, 240, 102,  29,  51,   0, 114,
       78,  28, 187,  38, 212,  34, 223,   4,  70,  65,  87, 205, 177, 249, 200,  47,
       79, 146, 154, 239,   5, 167, 133,   7,  36, 230, 109,  58,  43, 252,  66, 235
   },
   {
      233, 122, 161, 127, 108,  10,  13, 103,  38, 170,  67,   7,  34,  74,  95, 219,
      169, 240,  94, 136, 238, 198, 124, 246, 111,  80, 235, 204,  65, 194, 157, 184,
      102, 154, 251, 150,  21, 131, 135, 175, 109, 160, 227, 117,  29, 112,  16, 191,
       56,  44, 247,   6, 143, 202, 148, 211, 192, 155, 134, 130,  71,  79,   8, 242,
      110,  30,  28,  12, 105,  82, 146,  25, 178,  93, 253, 213,  45,  72, 185, 137,
      255, 229, 197, 120,  92, 226, 123,  64,  68,  53, 207,  75,  26, 248, 180, 158,
      141,  70, 234, 183, 215, 164,  63, 159, 107,  90, 196, 168, 162, 115, 236,  51,
      193,  22, 224,  17, 144, 114,  57,   2, 241,  61,  47, 156, 106,  59,  88, 220,
       87,  62, 165, 171,   0, 203, 254, 230, 250, 133,  32,  77, 113, 179, 176, 195,
        5,  14,  19, 181, 225,  97,  89, 177, 237,   3, 101,  99, 249, 100,  96, 126,
       41,   9, 129, 187,  43,  37, 221, 145,  35, 173, 252, 245, 119, 206, 140, 182,
       11, 222, 199,  86, 208,  91, 139,  27,  23,  46, 218, 152, 142, 200, 149, 201,
      188,   1, 223, 121, 239,  76, 153, 189, 125, 216,  18, 167, 210,  69, 209,  33,
      172, 118,  39, 104,  40, 163,  49,   4, 128,  50, 231,  73,  84, 205,  42,  54,
       81, 232, 212,  58, 217,  66, 147, 174, 132,  24, 190,  85, 138,  52,  48,  60,
      186, 243, 166,  55, 214,  36,  20, 116,  15, 244,  31, 151, 228,  83,  98,  78
   },
   {
      199,  12, 123,  17, 137, 178, 175,  84, 204, 132, 116,  80,  49,  24, 207, 149,
      173, 129,  15,  59, 113, 245, 169,  73, 119, 157, 128,  18,  66,  25, 202, 150,
      171, 240,  32, 136,   8,  55, 239, 101, 158,  97,  81,  78, 134,  89,   9, 156,
        3, 221,  37, 217, 118, 226, 200, 145,  68, 233,  38, 203,  44, 142,  72,  53,
      76, 102,  65,  94,  98, 153,  30,  58, 172, 174, 231,  21, 105,   4, 108, 120,
      222, 154,  34, 179, 183, 125, 208, 214, 160,  50, 177, 124, 167, 107, 244, 144,
      151, 165,  87,  74, 140, 241, 138, 205,  61, 189,  82,  63, 194,  48,  69,  75,
      168,  26,  79,  95, 238,  92, 248, 242, 243, 126, 190, 143, 250,   5, 170, 186,
      224, 159,  64,  23, 133,  85, 246, 218,  90, 210, 147, 110, 220, 201,  99, 223,
       14, 228, 176, 155,  45, 166, 139,  39,  11, 117,  91, 254, 103,  13, 216, 192,
       88, 135, 219, 161,  60,  62, 141,  86,  28, 181, 212,  40, 114, 180, 236,   1,
       20, 249, 188, 230, 193,  51, 255, 247, 131, 148, 111,  16, 106,  46, 100, 235,
      121, 109, 209, 164, 197,  54, 196,  36,   6,  41,  27, 127,  43,  31, 112,  93,
       77, 104, 227,  35, 198,   7,  19,  70,  57, 225, 184, 115, 122,  96,  10, 253,
       33,  83, 213, 237, 152, 252, 215,  47, 130, 185,  52, 206, 182,  42,  56, 229,
      191, 187, 251, 162,  67, 146, 163, 195,  71,   2, 211,   0,  22, 234,  29, 232
   },
   {
      129, 188, 179,  35, 251,  10, 201,  34, 178, 180, 159, 144, 165, 112, 199,  41,
      32,  46,  77, 232,  38,  64,  52, 238, 230, 106,  17, 234, 247, 194,  83,  40,
      239, 131, 105,  57, 222, 109, 248,   4,  54,  80, 120, 177, 111,  90, 227,  12,
      50, 143, 228,  62,  98, 254, 169, 162,  21, 167, 101, 157,   2, 206, 139, 224,
      175,  27, 133,  91,  73,  14,  95,  78, 114, 249, 122, 141, 103,  81, 176,  75,
      140, 219,  29,  42, 207, 203,  58, 223, 189,  33,  66,   1,  89, 119, 166, 116,
      160, 145, 117, 153,  25, 150, 110,  94,  15,  67,  13, 155,   7, 186,  53,  92,
      255,  26,  31,  24, 136, 187, 147, 135, 164,  30, 231, 200,  96, 126,  56, 208,
      253, 168, 197,  39, 214, 204,  82, 250, 217,  88,   8, 130, 241, 216, 171, 121,
      220,  11, 236, 198,  36, 125, 142,  84,  48, 172,  55,   6,  37, 104,  87,  79,
      44, 163, 185, 170, 124, 212, 107, 191, 123,  19,   9,  59, 118,  85, 215,  51,
      192, 237,  18,  74,  22, 184, 174, 151, 202, 209,  86,  28, 233,   5, 225,  43,
      115,  49, 181, 229,  68, 235, 152, 158, 102,  23, 137,  99,  70, 218, 211,  69,
      243, 252,  65,  16, 226,  20, 154, 196,   0, 156, 242, 146,  61, 182, 190,  97,
      3, 149,  63, 210, 127, 240, 161,  47, 108, 205, 246, 183, 244, 128,  60,  93,
      45, 221, 113, 148, 245, 195,  71, 100,  72, 134, 132, 138, 193,  76, 213, 173
   },
   {
      126, 150, 157, 167,  90,  48,  22, 116, 186, 160, 202,  86, 249, 182,  74, 250,
      92,  83, 145,  89, 219, 214, 109, 172, 232, 244,  60, 129, 222, 155, 209,  64,
      15,  34,   2,   6, 208, 254,  79,   0,  56, 220,  51,  85, 176, 197, 135, 161,
      106, 199,  13,   7, 104, 227,  66, 168, 190,  94,  57,  63, 255, 166,  73, 196,
      179,  93, 224,  54, 102, 107, 132, 149, 100, 217,  61,  68, 184,  17,  33, 115,
      137,  46,  96,  29,  14, 120, 252,  65,  40, 191,  95, 140, 165, 136,  23, 233,
      173, 174, 112,  80, 177,  75, 110,  53,  10, 225, 142, 215,  67, 105,   3, 146,
      205, 189,  39,  58,  31, 198,  76, 159, 200, 231, 193,  50, 153,  21, 131,  98,
      171, 154, 152,  11, 245, 180, 158, 218, 125, 201, 221, 187, 194, 147,  52,  30,
      148,  43,  87,  99,   8, 138,  32, 185, 113, 229,  62, 248,  41, 226, 247,  24,
      139, 143, 188, 144, 151, 169,  91,  71, 134,  69,   5, 117, 114,  77, 213,  82,
      121,  55, 243,  35, 239,  49, 238,  45,  44,  59, 162, 124,  27, 212, 195,  42,
      4, 163,  70,  36, 123,  38, 207,  20, 156,  97, 228, 237, 119, 108, 128, 118,
      130, 240, 127, 192,  28,  18, 183,  84, 111,  78,  88, 141, 203, 101, 242, 223,
      164,  12, 230,  16,  72, 236,  25, 235, 251, 204,  19,  37, 175, 133, 206, 211,
      178, 122, 253, 216, 181, 246,  81, 210,   9, 241, 234,  47,   1,  26, 170, 103
   },
   {
      167, 211, 117,   5,  35,  34,  85, 202,  43, 139, 120,  23,  99, 156, 225, 184,
      61,  94,  14,  79,  77, 188,  84, 105, 244,  50,  28,  80, 169, 223, 238,   6,
      58, 212, 236, 216,  70, 143, 163, 207,  11, 161, 102,  93, 249, 142, 234, 119,
      186, 227,  62,  37, 231,  89,  65, 242,  13, 185, 252, 159,  82, 250, 215,   3,
      194, 237,  63, 162, 147,  33, 193,  21,  49,  90, 181, 141,  87,  97,  74, 135,
      201, 190, 247, 129,  44, 165, 210,   2,  72, 151, 164,  46, 195,  68, 226, 177,
      112, 187, 154, 136, 219, 191,  81, 125,  98, 168,  32,  71, 127, 230,  73,  26,
      239, 196,  39,  88, 222, 124,  17,  52,   7, 248, 228,  96,  83, 166, 121,  31,
      66,  91, 233,  86, 208, 253,  38, 179, 108,  36,  42, 240, 197, 198, 138, 206,
      203,  48, 172,   8,  75, 214,  29, 110,  54, 221,  20,  47, 213, 153,  64, 218,
      205, 160, 144,  25, 173, 130,  76, 170, 251, 104,  67, 133, 224, 245, 100, 229,
      95,  24,  55, 107,  78,  10,  41, 113,   1, 176,  56, 180, 115, 217, 235, 192,
      209, 175,  92, 199, 101, 131, 111,  12, 155, 140,  18, 132, 171, 182, 106, 118,
      27, 114,  15, 152,  30,  69, 146,  45, 220, 254, 243, 255,  57,  16,  59, 126,
      103, 174, 137, 246, 189,   9,  51, 204, 232, 109, 116, 158, 123, 145, 134, 148,
      60,  22,  53, 122,   4, 128, 149, 157, 200,  19,  40,   0, 183, 150, 178, 241
   },
   {
      145, 109,  90,  98,  30, 162,  88,  60, 133, 236,  63,  68, 243,  72, 169, 128,
      214,  25,  76,  35, 107, 104, 183, 135, 192,  14,   9, 238, 160, 174,  81, 179,
      247, 165, 225,  36, 103, 138, 105, 210, 147, 211,  59,  92, 119, 227, 127, 113,
      229, 149,  79,  75,  62,  16,  99,  33, 213, 240, 207,   4, 106, 182, 152, 208,
      46,  69,  65,  70, 241,  61, 164, 156,  89, 212,  78,  96, 249, 204,  94, 111,
      66,  24, 223,  34, 242, 180,   8,  28,  49,  17,  15, 166, 163, 237, 144,  58,
      21,  10, 177, 124, 189, 131, 219, 222, 142, 102, 244,  43,  53, 246, 205,  18,
      141, 194, 231, 251, 155,  20,  85, 193, 150,  48,  45,  47, 209,  91, 255, 143,
      191, 226,  71, 176, 146,  80, 254,  57, 178,   5, 137, 188, 215, 112, 153, 168,
      170, 175, 203, 161, 115,  77,  83,  39, 218,  67, 110, 114,  51, 136,  29,  56,
      120, 181, 187,  50, 184, 173, 252, 122, 220,  73, 123,  84, 126,   7, 108, 171,
      1,  37,  82, 100, 224,  41, 195,  40,  64, 121, 253,   6,  19,  52, 117, 190,
      140, 198,  55,   2,   0, 132, 234, 245,  12, 232, 250, 158, 130,  95,  42, 199,
      93, 185,  23, 206, 116,  38, 230, 233, 196,  13,  26,  22, 118,  44, 172,  86,
      200,  97, 134,  32, 197, 139,  87,  74,  11,   3, 217, 216, 151,  54, 101, 154,
      157, 248, 148, 239, 159, 125, 221,  31, 228, 202, 201, 129, 235, 186,  27, 167
   },
   {
      155, 111, 126,  29, 135,  82, 148, 172,  10,   1,  99, 143,  64, 146, 221,  46,
      30,  25, 114, 216, 165, 181, 180,  96, 191,  65,  94, 223, 109, 198,  31, 253,
      225,  61, 201,  41,  24,  78, 173, 113, 158,  34, 245, 194, 207, 152,  80, 175,
      59,  60, 168,  50,  14, 177,  77, 195, 149, 162,  89, 119, 241,  11,  75,  87,
      67, 130,   7, 220, 254,  84,  55, 137, 238,  79, 125,  35,  74, 230,  18, 227,
      108, 210,  62, 103,  44, 138,  68,  32, 105, 237, 242, 247, 215, 134,  13,  48,
      58, 122, 244, 101, 163, 104, 182,  70, 142, 249,   6, 186,  88,  95, 112, 166,
      22,   4, 170, 224,  23,  85,  69, 167, 178, 200, 127,  86, 164,  38, 140,  92,
      16,  40,  63, 252, 184,   3, 171,   0, 144, 153, 226,   9, 128, 197, 187, 255,
      132,  26,  47, 234,  36,  57,  81, 213,  15, 246, 131, 202, 251, 159, 217, 124,
      136,  56, 199, 106,  17, 232, 183, 133, 117, 102,  33, 147, 190, 212, 151, 107,
      228, 231, 240, 185, 161, 157,  39, 209,  53,  90, 174, 193,  20, 229,  91,  66,
      206, 141, 110, 203,  73, 129, 218, 235, 150, 243, 204, 145,  12,  28,  51, 196,
      72,  52, 169, 160, 156,   5,  76,   8,  49, 154,  27, 118, 219, 211,  83,  21,
      71,  54, 192,  19, 222, 214, 188, 120,  98,  37, 179, 123,   2,  42,  97,  45,
      236, 248,  43,  93, 233, 115, 121, 250, 239, 189, 139, 176, 208, 116, 205, 100
   },
   {
      37, 178,  24,  76,  47,  68, 133, 147, 230, 157, 221, 120, 212, 125,  46, 117,
      63,  35, 195,  95, 213, 228,  45, 182,  49,  33, 138, 220, 197, 160,   5,  28,
      131,  96, 226, 237, 223, 164, 184, 247, 188,  29,  83, 180, 196, 209, 253, 207,
      243,  41,  75,  40,  92, 233, 217,  11, 121,   8,  94, 156, 238, 181,  77, 219,
      4, 200, 208, 161, 115, 176,  19,  36,   9, 104,  51, 110,  20, 248, 132, 101,
      107,  99, 127, 236,   2,  14,  38, 240, 206, 189,  69, 241, 186, 173, 148,  64,
      113, 118, 105,  48, 103,  79, 191,  59,  52, 190,  90, 252, 167, 150, 216, 108,
      50, 179, 136,  72, 174, 166,   0, 210,  91, 168,   7,  71, 134, 242,   1, 239,
      129, 227, 141,  13, 102, 111,  39,  15, 185, 154,  74, 122,  70, 130, 139, 231,
      172,   6,  67, 246, 224, 159,  21,  84,  62, 143, 140,  97, 229,  43, 175,  17,
      89, 198, 254, 171, 211,  98,  30,  27,  60, 201, 158,  80, 203, 119, 142, 152,
      232, 225,  65,  31, 187, 170,  10,   3, 146, 214,  34,  26, 123, 169,  61,  16,
      194,  23,  82, 137, 192, 199, 106,  66,  56, 162,  12,  25,  78, 128, 204,  85,
      234,  86, 153, 149, 244, 126,  54, 245,  44,  32, 202,  53, 100,  18, 215,  87,
      145,  57, 183, 235, 114,  88,  22, 250, 112, 135,  81, 109,  93, 249, 155, 116,
      163,  73, 165, 205,  42, 124,  55, 144, 255, 251, 193, 222, 218, 177,  58, 151
   },
   {
      187, 201,  29, 100, 208, 251, 135,  19,  36,  38, 221,  63, 127, 252,  98,  21,
      242,  60, 170,  78, 184, 236, 238,  75,   3, 121,  24, 224, 103,  61,  49, 160,
      118, 243, 164, 169,  18, 126, 144, 213, 235, 255, 146, 249, 197, 232, 159, 230,
      43,  32,  97, 202, 110,  90, 155, 173,  52,  50,  34, 148,  99, 142,  20, 178,
      162, 229, 222, 132, 114, 186, 212,  65,  51, 161, 157,  74,  57, 205, 108, 140,
      28,  44, 119, 190,  46,  69,  15, 253, 223, 254, 113,  96,  31, 151, 139, 203,
      168,  56,  66,  93, 154, 210, 149,  35,  59,  42, 143, 217,  77, 179,  94, 166,
      76,  16,  82, 124,   8,  53,  62, 245, 196,   9,   7, 171,  79, 174,  70, 209,
      111, 211, 104, 216,  72, 219, 105, 193, 106, 137,  85, 228,  86,  41, 175,  81,
      234,   2,  80, 182,  47, 204,   0, 131,   1, 180, 163,  67, 136,  11, 138, 188,
      23,  27,  64, 185, 117,  22, 199, 125, 150,  39,  37,  91, 206, 116, 225, 123,
      134,   6,  89, 218,  40, 198,  71,  25,  68,  58,   4, 200,  87, 189, 158,  84,
      141, 153, 244,  95, 172, 133,  48,  26,  30, 152,  55,   5, 128, 102, 156, 248,
      226,  33, 122, 147, 220,  73, 115,  12, 130, 214, 239, 181, 207, 237, 177, 191,
      54, 192, 129,  13, 112, 109, 240,  45, 107, 247, 145, 231,  83, 176, 195, 183,
      165, 233, 241,  92, 194, 101, 250,  10, 246,  14,  88,  17, 167, 227, 215, 120
   },
   {
      230,  22,  82, 116, 249,  96,  10,  50,  36,  15, 123,  89, 221, 133, 226, 125,
      218, 251, 253, 124, 150, 243,  32, 193, 225,  44, 129, 241,  92,  51,   6, 252,
      120, 106,  56, 134,  12, 136, 113, 168,  63,  84,   2, 200,  76,  71, 227,  70,
      11, 148,  74, 159,  53, 198, 231,  79, 183, 207, 242,   5, 155, 206, 234, 202,
      190, 101,   1,  75,  57, 186,  83,  78, 118, 236, 195, 119,  49,  58, 254, 127,
      59,  40,  21,  85, 157, 160,   0, 117,  38,  31,  86,  43, 199,  97, 142,  52,
      121, 170, 111,  87, 173, 165,  14,   8, 166, 178, 228, 182,  93, 146, 122, 135,
      130,  90, 158,  35,   9,  42,  69, 167, 240, 109, 110, 232, 203, 220, 156, 205,
      54, 204,  48, 138,  46, 144, 216, 185, 114,  34, 219,  88,   4, 211, 105,   7,
      215, 175, 181,   3,  37, 153, 131, 149, 128,  73,  66, 164, 145, 235,  18,  26,
      214, 174,  16,  72, 177, 237, 132, 143, 139,  41, 179,  17,  23, 223,  55, 141,
      115, 238, 213, 169,  60,  28, 209,  25, 196, 255, 176, 147, 108, 197,  27,  65,
      222, 247, 161, 171,  24,  99, 107, 244,  61, 140, 180, 246, 102, 104, 208, 201,
      224,  77,  45,  95,  94, 152, 126,  20, 250, 217,  64, 191, 163, 194, 103, 229,
      29,  91, 112,  81, 184, 187, 151,  19, 154,  67, 239,  30,  39, 192,  33,  62,
      189,  80, 245, 233,  13, 188,  98, 248, 137, 100,  68, 162,  47, 212, 210, 172
   },
   {
      127,  94, 211,  24, 140, 134,  73,  45,  28, 115,  39, 183, 242, 155, 232, 179,
      15, 254, 128,  82,  37, 168, 231,  84, 138,  49, 205, 142,  18, 164,  69, 221,
      158, 110,  51, 246,  11, 250, 229, 154, 217, 195,  61,  38, 102, 194, 206,  62,
      189, 144, 187, 243, 169, 196, 143, 191,  92, 247, 145, 248, 176, 202, 159,  12,
      148, 200,  70,  63, 225, 175,  17, 185,  30,  55, 132, 109,  34,  42, 123, 186,
      22,  65, 160, 153, 204,  25,  99,  35,  96,  68,  50, 192, 163, 213, 167,  97,
      173, 156, 162, 161,   1, 122, 241, 212,   7,  29,  71,  86, 216,  79, 215,  26,
      66,  58,  67, 238, 209,  13, 251, 124, 120,  74, 178, 113, 149, 139, 184,  31,
      64,  75,  56,  44,  83, 170, 151,   8,  87, 188, 104,  14,   4, 131, 118, 152,
      198,  81,  43,  90, 107, 180, 193, 147,  21, 103, 226,  19,  98, 129, 218,  93,
      41, 235, 199, 230, 166, 101, 237, 108, 181, 121, 220, 222,  53,  72, 239,  80,
      240, 207,  48, 106,  78,  10, 114, 126,  76, 252,  46, 197,  57, 210, 119, 255,
      224,  52, 203, 228, 223,  20, 182,  16, 234, 249,  89, 233, 190, 135,  54,   6,
      111, 208, 105,  32,  47,   0, 112,   9, 214,  95,  91, 146, 219, 136,  23, 100,
      172, 125, 117,  40, 244, 130, 236,  33, 174, 157,  77, 141, 137,   3,   5, 165,
      133, 227, 171, 245,  85,  88, 150, 116, 201,  60,  59,   2,  36, 253,  27, 177
   },
   {
      166,   4,  20, 181, 245,   9,  23, 187, 160, 209, 122,  64,  73, 241,  26, 127,
      243,  86, 124, 123, 206, 186, 138, 148, 198,  87,  43, 156, 140,  80, 111, 201,
      208, 144,  71, 230,  52, 121, 113,  82,   0,  33, 220, 171,  29, 192, 136,  72,
      170, 115,  81,   2, 107, 152, 182, 229,  15,   1, 135, 101, 149, 203, 158, 217,
      51,  18, 226, 137, 252, 251,  65, 178, 154, 131,  88, 120,  70,  66, 102,  14,
      224, 202, 143,  44,  46, 212,  92,  17,  56,  45, 155, 236,  74, 163, 128,  16,
      117,  61,  11,  24, 150,  60,  21, 129, 125, 116,   7, 114, 157,   8,  19, 185,
      159, 146, 239,  42,  47, 191, 188, 118,  48,   6,  62, 193, 233, 244, 110,  10,
      248, 103,  67, 216,  40,  39, 204,  12,  96, 255, 179,  79, 250, 253,  49,  28,
      175,  91, 238, 108, 190, 237, 105, 177, 145, 197, 215,  77,  50, 227,  69,  31,
      93, 132, 180, 249, 254,   5, 100,  78, 218,  98,  85,  36, 194, 130,  35,  95,
      162,  94, 176,  55,  57, 153, 184, 222, 161, 207,  58,  75,  54, 221, 247, 133,
      167,  38, 173,  30, 112,  22, 139, 134, 228, 225, 232, 104, 169, 213, 165,  13,
      223, 242,   3,  59, 195,  90, 214, 141, 119, 189,  76, 151, 246,  97, 147,  53,
      83,  89, 211, 240, 235, 196,  99, 172, 142, 126,  68,  84, 183,  34, 200, 174,
      210,  41,  37, 234, 164, 231, 168,  32, 205, 106, 109, 199,  25,  63,  27, 219
   },
   {
      119,  10, 236,  75, 239, 140, 103,  33, 240, 223,  70,  32, 152, 178, 189,   7,
      17, 137,  86,  58,   5, 171, 125,  90, 101, 148,  35,  20, 155, 167, 122, 104,
      13, 219, 130, 163, 186,  18,  26, 244, 149, 107, 177, 114, 227, 250,  31, 245,
      127,  63, 141,  34, 199,  38, 151,  54, 139, 108, 216, 159,  40, 203, 110, 194,
      87,  59,  80,  92,   6, 109, 215,  30, 249,  12, 224,  49, 182, 153,   0,  56,
      136, 233, 112,  23, 105, 179, 201, 207,  97, 143,  72, 222,  81, 168,  94,  47,
      102, 200,  68,  25,  53, 214, 232, 121, 175, 142,   3, 218, 154, 174, 164,  29,
      198, 169, 192, 208,  84, 138, 133, 191, 228, 221, 206,  44,  55, 126, 176,  73,
      76,  64,  67, 124, 120, 252, 146, 212, 118, 129, 255, 116,  11, 205, 230, 100,
      21, 251, 247, 229, 166, 210,  28, 238,  43,  61,  82,  14, 220, 246, 150,  24,
      195, 132,  46,   8, 111, 217, 197,  52,  71, 184, 190, 147, 128, 193, 172, 237,
      188, 225, 211, 131, 209, 158, 113, 165,  66, 253,  62,   2,  65,  19,  99, 241,
      234,   9, 254, 162, 145, 156, 115, 170,  85, 181,  39,  48, 117, 231, 157,  22,
      95, 134,  50, 183, 123,  98,  41, 248,  42,  93, 204,  91,  27,  83,  15, 144,
      69,  45, 161,   1,  89, 243, 235,   4,  37, 196, 226, 180,  36, 135, 187,  77,
      106, 160,  96,  88,  78, 173, 213,  51,  79, 202, 242,  74,  57,  16, 185,  60
   },
   {
      79, 234,  93, 110, 153,  73, 245, 145, 134,  68,  27, 217, 197, 248,  96,  23,
      219,  70, 230, 111, 118, 189,  29, 123, 241, 193, 165, 120, 156,  47,  62, 235,
      212, 161, 125, 238, 195, 101,  76, 135,  84, 254, 143, 178, 124,  56, 199,   1,
      99,  28,  57,   6, 152, 105, 151, 107, 169, 249,  95,  67, 218, 252, 173, 210,
      34,  59, 139,  69, 176, 209, 141, 231,  45, 154,  18,  72, 126, 109, 228, 177,
      52,  65, 206,  37, 244,  82, 116, 100,  44,  20, 128, 113, 158,  40,  89, 215,
      54, 243, 157,  63,  19,  10,  39,  51,  32, 175, 255,  35,   8, 150,  71,  22,
      174,  58, 247,  53, 106,  16,  85, 163,  46,  78,  17, 208, 166, 130,  64, 226,
      146,  94, 246,  92,  48, 162, 201, 194,   3, 203,  87,  50, 180, 233,  14, 227,
      90, 131, 136,  36,  38, 188, 253, 200,  42, 242,  81, 103, 204, 186,  83, 190,
      239, 220, 211, 108, 183, 184, 112,  13, 121,  21,  80, 179,   2,   5, 202, 225,
      86, 170,  91, 221, 182,  74, 137, 232, 222, 196, 114,  75,  12, 104,  97, 155,
      31,  25, 122, 142,  15, 213,  77,  26,  61,  66,  11, 216, 198, 147,  98, 181,
      149, 207,  55, 237, 160,  88, 127, 205, 192, 240,  43,   4, 172,   7,   9,  24,
      164, 251, 224,  49,  41, 102, 171, 250,  30, 168, 129, 159,  33, 144, 191, 148,
      187, 138, 229, 119, 132,   0, 185, 223, 236, 117, 167, 115, 140, 133, 214,  60
   },
   {
      137,  47,  48,  60, 215, 244, 217,  63, 249, 149, 206, 176,  33, 171, 222, 245,
      83, 186, 160,  82,  11, 224, 242, 129,  38, 125,  27,  98,   3, 203, 144,  51,
      139, 112, 138, 173, 143, 235, 219, 254, 207, 123, 105,  87, 205, 201, 228,  96,
      153, 152, 243, 162, 103, 195, 236, 247, 184,  92,  73, 170, 172,  49, 223,  84,
      28,  43, 191, 188, 141, 113,  31, 194, 117, 189,  85, 190, 121, 151,  19,  18,
      10, 126,  79,  65,  99, 180,  12,   0, 197,  59,  36, 154,   4, 192, 183, 169,
      120, 106, 220, 131, 216, 116,  86, 100, 165,  91, 146,  17,  93,  37, 252, 163,
      232, 233, 238, 159, 124, 196, 211,  24, 161, 185,  58,  46, 200, 178, 208, 140,
      168,  90,  50, 145,  66,  13, 198, 255, 240,  32, 181,  39, 150, 147,  21, 241,
      88,  26, 218,   9,  44,  70, 239, 237,  35,  78,   5,  30,  64, 193, 166, 101,
      53, 142,   1, 111, 134, 167, 229, 133, 109,  14, 158, 157, 230,  71,  67, 187,
      69, 148,  23,  57, 212,  40,  52, 118, 225,  61,  97, 246,  72,   7,  34, 155,
      179, 209, 231,  68,  45, 136, 221,  81, 250,  42, 204,  89, 128, 248,  29,  62,
      115,  95,   6, 253, 226,  75, 251, 119,  94,  80,  77,  76, 104,  16,  15, 210,
      199,  20, 227, 164,  22, 132,  56, 174, 130,   2, 135,  74, 202, 213, 122, 214,
      54, 182, 156,  55, 108,  41, 175, 127, 234, 110,   8,  25, 114, 102, 107, 177
   },
   {
      207,  32, 112, 185, 239, 189, 250, 136, 123,  68, 225,  53,  69, 216, 102, 196,
      231, 229, 176, 197,  11,  75, 161, 201, 104, 254,  89,   3,  67, 107, 142, 103,
      199,   6, 244, 203,  79, 159,  45,  63, 213,   0, 234, 160,  30,  71, 140, 132,
      81, 151,  72,  48, 226,   9,  38,  64, 125,  55, 253,  57, 198, 101, 126,  33,
      179,  16,  96, 114, 115, 186,  83, 240,  91, 194, 237, 141, 131, 208, 113, 232,
      120, 246, 169, 116, 109,  44,  84, 202, 248, 173, 150, 130, 133,  23, 236, 147,
      181, 187, 214, 145, 230,  20, 190, 154,  50,  21,  99, 215,  95,   5,  27, 211,
      241, 168, 245,  51, 105, 252, 148,   7,  97,  26, 108, 178, 167, 157, 227, 238,
      172, 174,  58, 183, 223, 243, 182, 177, 134,  78,  14,   8, 191,  18, 193, 219,
      98,  82, 146,  61, 218, 129, 184,  60,  52,  73,  90, 110,  65,  36,   2,  34,
      137, 143, 171, 153, 106, 124,  17, 156, 204, 249, 180,  85, 149, 200, 119,   1,
      29,  35, 206, 121, 122, 135, 162, 175, 228,  94,  19,  25, 195,  24, 242, 144,
      49,  10, 152,  43, 212, 224, 138, 139,  40,  31, 192,  56, 127,  15,  47,  28,
      158,  80, 165, 235, 221,  77,  70, 155, 222,  46, 166,  42,  87, 210, 100,  12,
      88,  76,  22,  62, 247, 251,  74, 163, 170, 217,  86, 117,  66,  37, 220, 164,
      233, 111,  59, 205,  39, 118,  92,  41,  54, 128,  13, 209, 188,   4,  93, 255
   },
   {
      112, 190,  24,  41,  17, 157, 156,   7,  26,  33, 240,  92, 107, 150,   0,   4,
      72, 125,  85,  22, 232, 235,  28, 165, 182, 233, 151, 123, 181,  91, 230, 177,
      145,  87, 124, 114, 148, 113, 238, 108,  48,   3,  56,  77,  69, 208,  27,  88,
      64, 210,   2, 215, 102,  19,  53,  46,  89,  11, 155, 167, 231, 173,  34, 153,
      251, 194, 203,  44, 130,  95,   5, 131, 183, 186, 197, 104, 138,   9, 214,  29,
      10,  50,  70, 152, 175, 223, 189,  60,  81,  49, 149,  67, 169, 211, 140, 170,
      32,  20,  76, 101, 139, 166,  97, 228, 171, 204, 239, 242,  40, 103,  21, 146,
      141,  62,  15, 180, 134, 136,  86, 100, 234, 127, 105,  84, 162,  37, 193,  30,
      61, 221, 220, 111, 248,  78,  59, 159, 202, 154,  65, 243,   1, 237, 218, 206,
      122, 110, 163, 187,  14,  94,   8, 144, 212,  79,  55, 118, 236,  54,  82, 178,
      109, 227,  93,  42, 188, 196, 201, 244, 160,  80, 119, 142, 245, 126,  63,  12,
      179, 205, 164,  75, 117,  90, 129,  35, 137, 184, 217,  47, 198, 158,  66, 147,
      68, 250, 224, 247, 161,  83,  45, 226, 185, 209,  39, 191,  25, 249, 199, 207,
      225,  43, 192, 143, 168, 254, 200,  18, 174, 222,  16, 216, 116,  23, 115,  31,
      219,  51, 121, 133,  57,   6, 213, 120,  98,  58, 106, 253,  52, 255, 132, 172,
      74,  13, 241,  36, 135,  38, 195,  73, 176, 252, 246, 229, 128,  71,  99,  96
   },
   {
      66, 177, 231, 178, 168, 179, 202, 122,  22,  24,   8, 147, 156,  79, 184, 171,
      86,  18, 176, 165,  14,   7, 209,  68,  76, 119,  59, 185, 141, 201, 142, 144,
      235, 211,  36,  31,  37,  15,  12, 192, 145, 115,  57, 123, 221, 253, 140, 167,
      239,  51, 173, 159,  62, 189, 249,  19,  93, 182, 101, 139, 160,  26,  44, 197,
      213,  21, 203, 188, 225, 246,  23, 136, 108, 251,   6, 129, 102, 174,  60,   9,
      45,  30,   2,  63,  92, 218,  65,  90,  75, 206,  69,  48,  54,   3,  91, 161,
      187, 131, 245,  58, 254,  11,  47, 219,  71,  39, 226,  78, 220, 237, 110, 236,
      158, 224, 114, 109, 196,  84,  46, 138,  96, 149, 133,  95, 107,  80,  27, 124,
      112,  94,  35, 212, 183, 194, 120,   5, 100,   4, 238, 113, 125, 217,  98,  81,
      150, 132,  73, 153, 243, 255,  72, 214, 205, 175, 233,  99,  50, 242, 186,  29,
      244, 195, 215,  42, 103,  20, 151, 248, 162,  88, 148, 155,  55, 117,  41, 241,
      229, 135, 247, 134,  33, 228, 200, 152, 208,   0, 111, 106, 190,  87, 130,  67,
      227,  56, 154, 166,  82,  38, 232, 223, 121, 210, 128, 143, 230, 204, 164, 104,
      64, 163,   1,  85, 172, 240,  70,  74, 193, 169,  40, 127,  16, 116,  25, 180,
      97, 216, 199, 181, 137, 252, 126, 105,  32,  34, 250, 198,  89,  28,  52, 207,
      43, 234,  13, 146,  10,  61, 118, 157,  17,  77, 191,  53, 170, 222,  83,  49
   },
   {
      108, 224, 197,  60,  88, 110, 240, 183, 134, 242, 254,  11,   2, 251, 186, 236,
      23, 225, 163,  18, 199,  30,  34, 107,   9,  89,  67,  78, 140,  36, 146, 232,
      167,  76, 190, 227, 145,   1, 149, 208, 249, 180,  87, 151, 158, 218, 115, 178,
      150, 231, 154,  21, 226,  95, 123, 127,  20, 112,   7, 250, 161, 193, 173,  35,
      142, 219, 188, 198,  99,  50,  92,  42, 213,   4, 207,  54,  48,  45,  47,  39,
      179, 137, 235, 229,  64, 132, 214, 228,  43, 159,  75, 102,  61, 103,  33, 233,
      72,  40,  96, 133, 246, 144, 221,  41, 166,  97,  62,  82, 176,  37, 184, 189,
      109, 220, 168, 205,  69, 135,  28, 131, 138, 171,  81,  91, 212, 169, 185, 215,
      16, 211,  90,  57, 160,  13,  77, 234, 206,  70,  79,  94,  66, 222, 187,  68,
      247,  80,   3, 239,  17,  65,  44, 170, 124, 136, 252,  56, 111,  71,  74,  46,
      84, 119,   6, 100,  83, 129, 143, 192, 202, 182, 243, 172, 196,  19, 155, 113,
      194,   5, 118, 153,  24, 253,  53,   8,  59, 101,  98,   0,  31,  22, 164, 130,
      106, 157, 120, 237,  55, 223, 114,  52,  12, 141,  15, 241, 217, 122, 174, 245,
      175, 204, 156,  73, 117,  38, 105, 165, 201, 177, 210, 200, 152, 244,  10,  14,
      126, 148, 125, 116, 255, 216, 104, 230, 248,  58, 191,  25, 162, 147, 238, 139,
      86, 203, 181,  32,  27, 195,  63, 128,  51,  29,  26,  85, 209,  49, 121,  93
   },
   {
      99,  46,  40, 240, 223,  11, 153, 190,  60,  83, 226, 174,  45, 231, 186,  33,
      180, 119, 206, 133,  69,  86, 239, 248,  84,  66,  65, 202, 115,  48, 196, 184,
      152, 175,  50, 100, 176,  55,  76, 218,  72,  53, 183,  26,  62,  36, 150, 156,
      172, 123,  89, 158, 101,  91, 108, 193,   2, 116, 131, 138,  28, 195, 236,  96,
      154,  31,  70, 128, 212, 143, 177,   6,  90, 191, 244,  10, 140, 145,  68, 215,
      63, 120,   4, 164,  79, 224, 178,  92, 210,  25, 113, 201,  64,   9, 229, 166,
      125,  34,  94, 135, 102, 169, 106,  38, 232, 233,  23,  37, 203,  59, 155,  29,
      105,  24, 241,  43, 157, 222, 230,  67, 185, 139, 237,  12,  56, 242, 209,   5,
      188, 182, 127, 253, 149,  71,  14,  52, 251, 170,  73, 142, 228,  98, 199, 227,
      171, 211, 134, 208, 151,  22, 249,  93, 219, 204,  82, 129,  41, 168, 130,  20,
      30, 217, 162,  49,  47, 126, 141, 255, 144,  74,  27, 205, 187, 214, 146,   1,
      198, 121,  54, 247,  77,   3,  57, 110, 103,  51, 160, 147,  81, 252,  32,  15,
      165, 221,  95,  42, 159, 117, 207,  18, 238, 220, 250, 148,  97, 114, 216, 124,
      200, 245,  35, 112, 181, 137,  80, 104,  78, 197,  58, 111, 161,  21, 167, 254,
      118,  17, 173, 235,  88, 192,  44, 109, 107, 246,  39,   8,  85, 243, 189, 122,
      0, 163, 225, 132,   7,  19, 136, 194,  13,  75,  87,  61,  16, 234, 179, 213
   },
   {
      49, 155,  71, 208, 191,  20, 195,  95,  64, 138, 209,  98, 186, 146,  75, 168,
      136, 220, 122, 133, 207,  38, 156,  14,  67, 199, 181, 140, 246, 231,  55,   3,
      244, 117, 167, 151, 166, 112,  63, 238,  13, 119,   6, 164, 141, 104,  47,  22,
      87,   9, 215, 159,  25, 161, 205,  94,  72, 150,  32,  15,   4,  93,  80, 237,
      130, 185, 108, 206,  83, 196, 193,  81,  17,  26, 233,  74, 240,  18, 123,  11,
      30,  21,  60, 204, 137,  23, 184,  89, 109, 132, 177,  97,  52, 213, 236,  12,
      147,  24, 214, 175,   1,  45,  53, 157, 111, 197,  56, 188, 187,   8, 114, 144,
      84, 131, 189,  99,  39,  79, 217, 227,  90, 211,  48, 171, 218, 139, 174,   2,
      216, 110, 203, 251, 241,  86, 153,  43, 106, 148, 252,  65,  76, 212, 169, 115,
      142, 134, 121,  29,  58,  40,  10,  70, 152,  51,  54, 113, 126,  27, 180,  57,
      182, 224, 149, 249,   5,  85,  62,  88, 235, 172, 135,  91,  31, 120, 179,  37,
      190, 105, 253, 107,  16,  96,  77, 200, 226,  46, 219,  61, 202, 221, 194,  35,
      7, 124, 239, 232,  42, 143,  69,  73,  82, 129,   0, 145, 225,  41, 162, 210,
      198, 163, 154, 100, 158, 243, 127,  28, 201, 118, 165, 248, 229, 125, 222, 242,
      33, 250,  34, 160, 178, 101, 183,  78, 234, 128,  92,  59, 245, 116, 228, 230,
      103, 170,  19, 192,  66, 255, 176,  68, 223, 102, 173,  44,  50, 247, 254,  36
   },
   {
      235,  36, 210,  86, 120,  54,  56,  42,  24, 137,   8, 174, 190,  15, 214,  49,
      59, 195,  40, 212, 198, 132,  62,   5, 106,  22, 187, 113, 157, 144,  25, 197,
      14,  63, 168,  71, 216, 131, 153, 248, 134, 160,  48,  52, 164, 252, 205, 213,
      0, 221, 154, 177, 141, 237,  99, 194, 180,  92, 242,  37, 143, 125, 239,  12,
      23,  53,  91,  83, 129, 161,  38,  95,  90,  94, 173, 200, 150,  18, 118,  16,
      89,   6, 147, 227,  65, 114, 226, 240, 176, 130,  80, 223, 184, 124, 101,  27,
      246, 228, 162,  77, 167,  97, 127,  30, 170, 245,  31,  74, 102, 117, 175, 110,
      234, 208,  61, 225,  13, 111,  68,  45, 215, 233, 116, 100, 135,  81,  51,  60,
      181,  33,  34, 138, 254, 218,  29, 255,  41, 179, 104,  75, 201, 247, 229, 152,
      232, 186,  76,  50, 199,  87, 217,  79,  43, 103,  85, 169,  69,  73, 238,  58,
      107, 189, 183, 158, 243,  44, 159,   7, 191, 165, 119, 211, 244,  21, 105,  84,
      166, 209, 115, 178, 151, 136,  82, 156,   3,  66,  70,  26,  78,  17, 149, 219,
      39, 202, 250, 231,  28, 139, 192, 251,  47, 172,  32,   2, 142, 193, 182, 253,
      140,  10, 206, 236, 220, 108,  11, 222,  46,  57,  93, 128,  96,  98, 207, 188,
      185,  35,  19,  88,   9, 171, 203, 204,  55, 224, 133, 122,  20,  67,  64, 126,
      230,  72,   4, 121, 148, 123, 241, 109, 196,   1, 163, 155, 145, 112, 249, 146
   },
   {
      196, 160, 174, 230, 236,  36,  18,   9, 108,  66, 183,  77, 123,  69,  51,  60,
      52, 164,  90, 253, 240, 152,   0, 211, 218,  35,  16,  19,  43, 213,   8, 141,
      207,  10,  17, 188, 103,  14, 113, 201, 158,  57,  63,   6, 132,  74, 130, 195,
      167,   1,  95, 112, 254,  87, 110, 100, 102,  21, 181,  61, 208, 147,  53,  42,
      220,  24,  12, 199, 115,  31, 116, 133,  64, 105,   3, 122, 139, 180,  47, 154,
      229, 192,  82,  26, 246, 162, 228,  70,  91,  58, 241,  85,  65,  81,  72, 109,
      175, 170,  59, 101, 203,  15, 239, 189, 144, 251, 190, 237, 126, 227,   5, 146,
      217, 248, 231,  25, 205,  23, 143, 232,  40, 165,  48, 194, 209, 250,  56, 191,
      166,  32,   2, 216, 200,  73, 127, 182,  46, 215, 214, 104, 129,  99, 197,  22,
      245, 185,  38, 111,  28, 210,  33, 198,  29, 177,  75, 125, 145, 187,  11,   4,
      247, 193, 176,  45, 178,  97, 134,  98,  39, 124,   7, 120, 107, 161,  49,  27,
      243, 137, 223,  83, 169,  93,  76, 222,  62, 173,  44, 171,  68, 244, 157, 148,
      224, 151,  41, 128, 206, 118,  20, 186, 121, 119, 149, 179, 252, 235,  94,  78,
      138, 168, 226, 212, 131,  92,  71, 117,  50, 225, 249, 156, 114, 142, 163, 234,
      233,  55, 204,  96,  86, 153,  84, 140, 150, 219, 184, 155,  37, 136,  88, 255,
      79, 159, 238, 172, 106,  67,  89, 135,  13,  54, 242,  30,  80,  34, 202, 221
   },
   {
      90, 144, 152,  48,  58, 123, 212, 106,  55, 178, 180,  31,  99, 223,   9, 183,
      248,  19, 254,  12,  66,  92, 164,  89, 115, 218, 112,  51, 191, 198, 169, 230,
      74,  52,  25, 188,  10, 141, 196, 140, 216, 249,  46,   8, 136, 199, 156, 250,
      126,  50, 111, 184, 243, 177, 163, 234, 179,   5, 130,   2, 103, 137,  29,  61,
      195,  17, 197,  80, 205, 128, 252,  49, 105, 153,  24, 238,  35,  68, 107, 104,
      242,  85, 131,  54, 119,  40, 228, 124, 209,  20, 229, 170, 211, 227,  11, 116,
      70, 208,  87, 185,   0, 154, 210, 201,  62,  14,  64, 217, 166,  84, 240,  41,
      226, 158, 113, 194,  67, 236,  44,  57, 139, 174, 207, 190,  38, 247,  96, 165,
      79, 246,  33, 232,  98, 127,  93,   1, 171,  36, 237, 120, 225, 117, 125, 108,
      3, 206, 253, 202,   4, 186,  71, 101, 159, 168,  34,  18, 134,  91,  88,  16,
      59, 187, 175,  42, 224, 241,  39, 122,  83, 193, 157, 148, 222, 189,  43, 102,
      82, 160,  37,  45,  75, 143, 176, 151, 235, 244, 192,  26,  97, 182,  73, 245,
      239, 181, 213,  69, 162, 203, 251, 221, 173,  86,   7, 135, 204,  65, 200, 233,
      95,  76,  78, 215,  32,  30,  22, 129, 147, 231, 161,  81, 167, 142,  15, 110,
      77, 132, 172,  72, 255,  13, 118,  47, 220, 214, 138,  53, 109, 100,  21, 146,
      23,  94,  63, 133, 114, 149,  60,  28, 150,  56,   6, 155, 219, 121,  27, 145
   },
   {
      41,  57,   2, 128, 186, 227, 101, 153, 251, 156,  15,  14,  97, 247, 226, 237,
      94,   0, 163, 184, 209,  89, 164, 151, 118, 238,  26,  51,  48, 205, 104,  71,
      72, 142,  45,  64, 113,  73,  80, 218, 136, 120,  62, 146,   1,   8,  21,  40,
      121,  32,  84,  68,  93, 152, 178, 176, 129,  61, 232,   4,  86, 243, 233,  99,
      155, 111,  69, 160,  44, 206, 224,  85, 185, 143,  17, 204, 179, 125, 200,  42,
      168,  59, 115, 244,  75,  60, 150, 255, 207, 174, 112, 139,  81, 192,  50,  20,
      78,  79,   6, 182, 235, 157,  16,  25, 133, 188, 187, 162, 108, 141,  24, 236,
      231, 130, 109,  58,  83,  87, 191, 122,  29,  67, 203,  43,  96, 228, 123,  82,
      214, 147, 166, 196, 229,  91, 145, 217,  66,  23,  54,  19,  56, 100, 222, 241,
      170, 219, 216, 154, 202, 220, 246, 102, 225, 158, 116, 132,  95,  47, 144, 167,
      7,  88,   3,  98,  55, 148, 190, 181, 138, 172, 213,  46, 119,  90,  38, 210,
      22, 161, 171,  13, 239, 253, 103,  65, 211, 173, 193,  31, 201, 252, 208,  92,
      12,  35, 183,  34, 240, 199, 124, 230, 131, 126, 159, 189, 215, 117,  37,  28,
      10, 140,  49, 245, 135, 127, 234,  53,  70,   9, 114, 254, 197, 134,  11, 169,
      242,  76,  33, 221, 195,  18,  39, 212, 248, 165, 223, 198,  77, 250, 137, 106,
      52, 249,  74, 105,  36, 107, 110,  27,   5, 175, 149, 194, 180,  30,  63, 177
   },
   {
      35, 131,  14,  46,  83, 157,  24,  43, 128, 225, 196,  73,  30, 121,  67,  93,
      89,  26, 180,  21, 158,  59,  34, 198,  10, 135,  47, 104, 129,  92, 151, 172,
      19,  39, 231, 130, 113, 221, 155, 142,   6,  64, 102,   2, 161, 144, 250, 252,
      242, 254,  25, 224, 119, 111,  50, 248,   5, 143, 189,   1,  71, 173, 160, 103,
      169, 219, 154, 237,   7,  68,  91, 185,  11, 163, 149,  32, 253,  23,  79, 175,
      117, 228,  76,  28, 217, 207, 191, 229,  97,  74,  27, 179,  99, 194,  96,  58,
      236, 187, 170,  65,  13, 235, 212, 165, 118, 190, 145, 192, 164, 148,  53, 177,
      208, 136, 188, 127,  78, 243,  55, 153, 234, 120, 137, 183, 178, 109, 152, 240,
      9, 123, 238,  51,  98,  16, 195,  85, 239,  75, 108, 205,  62, 181, 162,  81,
      88,   3, 134,   0, 141,  17,  72, 176, 139, 251,  84, 213, 125, 216, 186, 110,
      40, 171, 244, 209, 201, 255,  22, 101,  90,  61,  57, 226, 116, 133, 167, 203,
      168, 182, 249,  38,  60,  49,  44,  45, 100, 227,  18, 210,  66, 233, 115, 150,
      41, 106,  15, 114,  77, 132,  36,  95, 166,  48, 222, 174, 138, 156,  63, 218,
      8, 184, 126, 215, 230, 220, 105, 214, 107,  82,  80,  70,  12, 202,  29,  87,
      159, 146,  31, 199,  69,  33, 122, 241,  20,  54, 193, 247, 245, 204, 232, 197,
      211,  52,   4, 147,  86, 246,  42,  56, 112, 223, 206,  37, 140,  94, 200, 124
   },
   {
      229,   5, 196, 101, 154,  64, 145,  12, 235, 130,   0,  35, 109, 215,  23, 151,
      10, 167, 218,  90,   8,  88,  46,  29,  62,  54, 203,  57,  86,  96,  49, 230,
      252, 127, 210,   9,  55,  59, 180, 155, 163,  36, 165, 191, 224, 156, 248, 103,
      192,  60,  97, 186,  50, 185,  53, 116,  20,  61, 125,  85,  84, 237,  41, 220,
      136,  71, 253,  98, 146,  13, 233, 123, 114, 104,  22,  81,  27,  42,  34,  17,
      153,  65, 208, 100,  15, 131, 106, 194,  16, 193, 121, 122,  56,  58, 147,  66,
      132, 173, 246,  21, 181, 172, 112,  24,   3,  93, 223,  76, 177, 201, 139,  32,
      184,  79, 133, 150,  99, 238, 120, 249, 161, 170,  37, 225, 222, 137,  52, 117,
      174, 179, 199, 138,   2, 128, 164, 216, 158,  72,  92, 231, 176, 189,  39, 108,
      234, 205, 110,  33, 143, 227,  26,  31, 168, 159, 175, 251,  67, 157, 213,  18,
      40, 188, 178,  75, 211, 242, 214,  89, 241, 105,  51, 111, 144, 115,  83,   6,
      217, 254, 226,  30, 195, 187,  74, 160,  73, 240, 126,   4, 134,  69, 200, 166,
      228,  48, 245,  91,  38, 250,  44, 119, 140, 190, 247, 113, 236, 198, 255, 148,
      212, 202,  95, 183, 162, 182, 118, 204,  11, 152,  87, 209,  94,   7, 107,  45,
      77,  63,  28, 239,  47, 219, 129, 124, 206, 197,  80, 243, 169,  14,  43, 232,
      149,  19,  70, 141,   1, 207, 135, 142,  78,  68, 244, 171, 221,  25,  82, 102
   },
   {
      69,  77, 219,  17,   4,  39, 122, 116, 244,  21, 237,  86, 243, 181, 186, 135,
      101, 212, 203, 120, 210,  65,   3, 247,  23,  32,  79, 115,   6, 241, 251,  92,
      233, 252,  67, 195, 227,  16, 216,  26, 143, 129, 232, 249,  58,  49,  91,  34,
      48,  76,  96,  43,  27, 182, 166,  62, 190,  83,  97,  66,  35, 121,   5,  54,
      191, 184,  41, 130,  33,  82,  29, 145,  60, 209, 250,  84, 123, 211,  31, 107,
      221, 173,  78,  50,  59, 155, 194, 139,  11,  52, 170, 136,  99,  81,  55, 234,
      45, 142,  14,  89,  85,   2, 171, 105, 214, 178,  13,  19,  61,  38, 124,  10,
      185,  28,  71, 117, 218, 188, 240,  73, 175, 176,  63, 213, 197, 236, 204, 113,
      164, 125,  25, 220, 111, 131, 104,  93, 154, 228, 165,  90,  51,  46,  37,  40,
      8, 106,  18, 226, 158, 235,  44, 152, 229, 100, 134, 119,  88, 108, 141,  56,
      161, 160, 127,  98, 200, 147, 114, 189,   9, 192, 217, 137,  53,  68, 255,  94,
      177, 128, 196, 172, 163,  47, 208, 153, 118, 248,  87, 242, 102,  22, 202, 187,
      138,  75, 231, 224,   1, 144, 222, 201, 149, 205,   0, 132, 126, 103, 162, 225,
      183, 207, 168,  72,  57, 112, 254,  42,  36,  70, 156, 238,  80, 159, 180, 151,
      157, 239, 215,  15,  74, 246,  12,  95,  24, 140, 167,  20, 109,  30, 133, 198,
      7, 179, 146,  64, 199, 245, 110, 169, 230, 206, 193, 174, 148, 150, 253, 223
   },
   {
      9, 218, 225, 171,  69,  66,  63, 246, 179,  45, 119,   2, 156, 214, 198, 223,
      255, 231, 113, 146, 104,  67, 220, 123,  37,  52,  46, 230, 169,  21,  54,  58,
      172,  82, 105, 136, 240, 248, 253,  83,  87, 252, 200, 144, 116, 224, 185,  10,
      163, 213, 228, 245, 206, 207,   1,  44, 194, 250,  65, 217, 251,  26, 130, 241,
      184, 195, 176,  92, 129, 187, 168, 159, 145, 190, 153, 201, 232, 139, 150,  75,
      103, 205, 140, 170,  24,  64, 124,  72,  70, 199,  86, 238, 102, 154,  56,  12,
      15,  35, 186, 161,  90, 141,  29, 227,  98, 134,  36, 242, 196,  62, 221, 226,
      164, 236,  73,  93, 115,  28,  59, 166,  55, 247, 127, 212,  68, 191,  42,  53,
      197,  33, 208,  22, 209,  43, 182, 243,   6,  61,  94, 211, 162, 110,  88,  27,
      234, 188,  40, 133,  84, 112,   3, 165,  79, 100,  81, 203, 132,   0,  39, 192,
      142, 157,  78,  13,  16, 125, 135, 244, 167, 106,  85,  31, 233,  96,  49,   7,
      71, 121, 174, 210, 137, 152, 215, 107, 138,  32, 101, 111, 189, 148,  14, 237,
      89, 128, 131,  18, 249,  51, 216,   4, 204, 202, 114,  97,  41, 173,  60,  38,
      117, 147, 126, 143, 160,  99, 229, 239, 109, 149,   5,  76, 180, 181, 183,  25,
      20, 122, 178,  23,   8,  50, 219, 151,  34,  11, 118, 175, 108,  17,  48, 193,
      80, 155,  19, 254,  30,  74, 177,  95, 222, 120,  57, 235,  91,  77, 158,  47
   },
   {
      150, 186, 177, 238,  63, 141, 181,  81, 180,  66,  28, 194,   3, 170,  11,  93,
      9,  16,  65, 104, 166, 127, 234,  90,  36, 237,  21, 228, 232,  73, 197, 115,
      135,  67, 138, 101,  83, 131, 124, 114, 187,   2, 110,   7, 173, 219, 113, 252,
      142, 208, 103, 192, 125,  34, 107,  99,   5, 188, 202, 161,  77, 139,  96,  32,
      64,  10, 171, 116, 231, 200, 157, 245, 106, 120, 158, 206, 162, 174, 235, 128,
      76, 105,  44, 214,  84,  56, 149,  60,  33,  50,  38,  82, 250,  88,  39, 167,
      15, 247, 242,  22, 179,  13,  24, 182,  86, 152,  61,   1,  98,  31, 164,   8,
      159,  48, 148, 191, 251, 211, 176,  57, 118,  54, 123, 132, 163,  92, 233, 100,
      248, 140, 109,  62, 130,  55,   0, 112, 203, 155, 215, 175, 117,  91, 239, 218,
      111, 153,  46, 253,  12, 223,  80, 126, 172, 216,  20, 193,  68, 136,  53,  37,
      41, 137, 209, 183, 220,  75, 122, 254, 241,  89, 168, 144, 154,  74, 129,  59,
      199, 160,  97, 213, 240,  87, 226,  70, 184, 147, 205, 165, 185, 169, 246, 229,
      204, 249, 151, 255,  43,  26,  23, 212, 221,  52,  25, 178, 217, 134,  19, 190,
      201,  18,  69,  78,  30, 102,  71, 207, 236, 119, 195,  95,  49, 156,  94, 243,
      17, 143, 121, 227, 244,  29, 225,  14, 224,  47,   6, 230,  51, 222, 189, 196,
      40, 146, 133, 210,  85,  42, 145, 198,  35,  58,   4,  27,  72,  45, 108,  79
   },
   {
      79, 120, 240,  22, 177, 167, 152, 146, 248, 188,  85,  20, 229,  81,  92, 132,
      207, 203,  30,   8, 162, 215, 111, 116, 201, 228,  63, 175, 106, 218,  40, 247,
      166,  44, 191, 114, 254,   7,  38, 122,   9,  93, 154, 224, 246,  12,  88, 210,
      133,  17,  73, 123, 138, 179,  11, 113, 151, 145,  50,  24,  58, 129,  47, 141,
      195,  49, 168,  95,  19, 159,  43,  48, 124,  75, 185,  90,  34,  51, 112,  55,
      241,  21, 183,  39,  72, 189, 223, 172, 197, 161, 220,  33,  18,  78, 199,  45,
      147,  53, 244,   4, 222, 186, 153, 194,  60,   3, 163, 209, 136,  98,  91,  37,
      234, 213, 103, 105, 118, 121, 235, 155,  35,  61,  70, 125, 131, 216, 202,  23,
      101, 255, 193, 242,  97,  84, 117, 212, 190,  76,  64, 192,  13, 206,  27,  32,
      54, 221, 134, 251,  42,   6, 250,   5, 148, 231,  56, 110, 115,  82, 143, 164,
      80,  96,   1, 137,  31,  57, 182, 126, 196, 252,  74,  67, 156, 139, 160,  71,
      16, 230, 239, 225, 253,  89, 249, 157, 226, 170, 165,  99, 140,  14,  87, 171,
      158, 198, 219, 211, 104, 100, 128,  68,  83,  59,  25, 233,  29, 176, 187, 184,
      66,  173,  41,  65,  69,  10, 214, 200, 174,  62, 108,  52, 107, 245, 119,  94,
      169, 149, 144, 237,  46, 135, 181,   2, 204,  86, 150, 208, 232, 205,  28, 127,
      142, 236, 109,  15, 238, 217, 227,   0,  36,  26, 180, 243, 178, 130,  77, 102
   }
};

/* Each number is relatively prime with 256
 */
static const byte increments [MAX_NSETS] = {
   3,   5,  7,  9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33,
   35, 37, 39, 41, 43, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 65
};

static int number = 0;          /* 1 .. MAX_NSETS */
static byte positions [MAX_NSETS];
static byte map_index [MAX_NSETS];
static byte map_count [MAX_NSETS];


/*------------------------------------------------------------------------------
 */
static void initialise (const char* phrase)
{
   const byte* key = (byte*) phrase;
   const int n = strnlen (phrase, 1024);

   byte scrunched_key [MAX_NSETS];
   int j;

   for (j = 0; j < MAX_NSETS; j++) {
      scrunched_key [j] = 0;
   }

   for (j = 0; j < n; j++) {
      int i = j % MAX_NSETS;
      int p = (i + 31) % MAX_NSETS; /* the previous */
      int n = (i +  1) % MAX_NSETS; /* the next */

      int t = (scrunched_key[p] << 3) ^ key [j] ^ (scrunched_key[n] >> 1);
      scrunched_key[j] ^= t;
   }

   /* Set the number to use
    */
   number = n > MAX_NSETS ? MAX_NSETS : n;

   for (j = 0; j < number; j++) {
      positions [j] = scrunched_key[j];
      map_index [j] = scrunched_key[j] % MAX_NSETS;
      map_count [j] = increments [scrunched_key[number - j] % MAX_NSETS];
   }
}

/*------------------------------------------------------------------------------
 * Returns the next byte to xor with.
 * Also updates the map index positions.
 */
static byte next_xor ()
{
   if (number <= 0) return 0xFF;  /* mage version 1 compatible */

   int j;

   byte result = positions [0];
   for (j = 0; j < number; j++) {
      int mi = map_index [j];
      byte t = map_data [mi][result];
      result = t;
   }

   /* now increment the postions
    */
   for (j = 0; j < number; j++) {
      int p = positions [j] + map_count [j];
      positions [j] = p % 256;
      if (p < 256) {
         /* no wrap around */
         break;
      }
   }

   return result;
}

/*------------------------------------------------------------------------------
 */
static void usage (FILE *stream)
{
   fprintf (stream, "usage: mangle [[-k,--key] phrase] [input_file [output_file]]\n");
   fprintf (stream, "       mangle -v | --version\n");
   fprintf (stream, "       mangle -h | --help\n");
}

/*------------------------------------------------------------------------------
 */
static void help ()
{
   fprintf (stdout, "mangle %s\n", MANGLE_VERSION_STRING);
   fprintf (stdout, "\n");
   usage   (stdout);
   fprintf (stdout, "\n");
   fprintf (stdout, "mangle mangles a file or standard input to a file or standard output.\n");
   fprintf (stdout, "Note: mangle is not cyrptographically secure - that's not its purpose.\n");
   fprintf (stdout, "mangle is the binary equivalent of ROT13 - it does just enough to fool\n");
   fprintf (stdout, "those pesky e-mail filters.\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "mangle an involutory program, i.e. it also de-mangles as mangle is its\n");
   fprintf (stdout, "own inverse:\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "   mangle  foo bar\n");
   fprintf (stdout, "   mangle  bar recovered_foo\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "foo and recovered_foo are identical, bar is a \"mess\".\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "Options\n");
   fprintf (stdout, "--key, -k     Provides a mangling key phrase for a little bit more privacy.\n");
   fprintf (stdout, "              The same key phrase must be used for mangling and de-mangling.\n");
   fprintf (stdout, "              If/when no key phrase is provided, then mangle is compatible\n");
   fprintf (stdout, "              with the mangle version 1.1.n\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "--version, -v print mangle version and exit.\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "--help, -h    print this help information and exit.\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "Parameters\n");
   fprintf (stdout, "input_file    the file to be mangled/demangled. When no input file specified, or\n");
   fprintf (stdout, "              just '-' specified, the input is taken from standard input.\n");
   fprintf (stdout, "\n");
   fprintf (stdout, "output_file   target demangled/mangled file. When no output file specified, or\n");
   fprintf (stdout, "              just '-' specified, the output is sent to standard output.\n");
   fprintf (stdout, "\n");
}


/*------------------------------------------------------------------------------
 */
static int mangle_it (const int fdin, const int fdout)
{
   byte buffer[8192];
   ssize_t bytes_read;
   /* ssize_t bytes_written; */
   int j;


   for (;;) {
      bytes_read = read (fdin, buffer, sizeof (buffer));

      if (bytes_read == 0) {
         break;                 /* all done */
      }

      if (bytes_read < 0) {
         perror ("");
         return (-1);
      }

      /* NOTE: Not cyrptographically secure - that not the intension.
       * What mangle is up-to is just enough to fool those e-mail filters.
       */
      for (j = 0; j < bytes_read; j++) {
         byte b = next_xor();
         buffer[j] ^= b;
      }

      /* bytes_written = */
      write (fdout, buffer, bytes_read);

   }
   return 0;
}      /* mangle_it */


/*------------------------------------------------------------------------------
 */
int main (int argc, char** argv)
{
   char message[200];
   int fdin;
   int fdout;
   int status;

   /* skip progran name
    */
   argv++;
   argc--;

   if (argc >= 1) {
      if ( (strcmp (argv [0], "--help") == 0) ||
           (strcmp (argv [0], "-h") == 0) ) {
         help ();
         return 0;
      }
   }
   
   if (argc >= 1) {
      if ( (strcmp (argv [0], "--version") == 0) ||
           (strcmp (argv [0], "-v") == 0) ) {
         fprintf (stdout, "mangle %s\n", MANGLE_VERSION_STRING);
         return 0;
      }
   }

   if (argc >= 1) {
      if ( (strcmp (argv [0], "--key") == 0) ||
           (strcmp (argv [0], "-k") == 0) ) {
         if (argc < 2) {
            fprintf (stderr, "missing key phrase argument\n");
            usage (stderr);
            return 1;
         }

         initialise (argv [1]);

         argv++;
         argv++;
         argc--;
         argc--;
      }
   }

   if (argc >= 3) {
      fprintf (stderr, "unexpected number of arguments\n");
      usage (stderr);
      return 1;
   }

   /* std in to std out - the default
    */
   fdin = 0;
   fdout = 1;

   if (argc >= 1) {
      if (strcmp (argv[0], "-") != 0) {
         fdin = open (argv[0], O_RDONLY);
         if (fdin < 0) {
            snprintf (message, sizeof (message),
                      "failed open input file '%s' ", argv[1]);
            perror (message);
            return 1;
         }
      }
   }

   if (argc >= 2) {
      if (strcmp (argv[1], "-") != 0) {
         fdout = creat (argv[1], S_IRUSR | S_IWUSR);
         if (fdout < 0) {
            snprintf (message, sizeof (message),
                      "failed create output file '%s' ", argv[2]);
            perror (message);
            return 1;
         }
      }
   }

   if (fdout != 1) {
      fprintf (stdout, "mangle %s\n", MANGLE_VERSION_STRING);
   }

   status = mangle_it (fdin, fdout);

   return status;
}

/* end*/
